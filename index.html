<html>
<head>
  <script src="https://code.jquery.com/jquery.js"></script>

  <!-- Note: Probably not the way 'bower' dependencies are supposed to be used, but works for us.
  -->
  <script src="bower_components/svg.js/dist/svg.js" type="text/javascript"></script>
  <script src="bower_components/svg.draggable.js/dist/svg.draggable.js" type="text/javascript"></script>
  <!--
  <script src="bower_components/assert/dist/assert.js"></script>
  -->
    
  <script src="node_modules/rx-lite/rx.lite.min.js"></script>
  <script src="js/svg.track.js"></script>
  
  <style>
    rect.main { 
      fill: blue;
      fill-opacity: 0.8;
    }
    rect.main2 { 
      fill: purple;
      fill-opacity: 0.8;
      stroke: brown;
      stroke-width: 3 px;
    }
    rect.corner { 
      fill: yellow;
      fill-opacity: 0.5;
    }
    rect { 
      fill: purple;
    }
  </style>
</head>

<!-- Make a rectangle with corners as separate rectangles, so that everything
- follows each other (i.e. corners resize the big rect, panning bit rect moves
- also the corners).
-->
<body>
  <div id="cradle">
  </div>
  
  <script>
    var W= 100;
    var CORNER_SIZE = 20;
    var CORNER_OFFSET = 5;
    
    var svg = SVG("cradle");   // fills the cradle fully

    //--- Track changes to an element ---
    //
    // Tracks dragging, or explicit positioning/stretching to an observable.
    //
    (function () {
      var g2 = svg.group();
    
      var xObs = new SVG.Observable(),
        yObs = new SVG.Observable(),
        wObs = new SVG.Observable(),
        hObs = new SVG.Observable();
  
      // Main rect, bound to the corners dynamically (tbd: push below them)
      //
      var rect= g2.rect(W,W)
       .addClass("main2")
       .draggable()
       .track( xObs, yObs, wObs, hObs );
      
      g2.move(150,50);
  
      // Note: We start receiving values from here on (earlier changes are not stored for us).
      //
      xObs.subscribe( function (v) { console.log("x -> "+ v); } );
      yObs.subscribe( function (v) { console.log("y -> "+ v); } );
      wObs.subscribe( function (v) { console.log("width -> "+ v); } );
      hObs.subscribe( function (v) { console.log("height -> "+ v); } );
  
      rect.x(120);
    })();
        
        
    //--- Bind pieces together ---
    //
    // Corners are directly bound to the main rectangle's position and dimensions.
    //
    (function () {
      var g = svg.group();
  
      g.move(50,50);
  
      var obsX = new SVG.Observable(),
        obsY = new SVG.Observable(),
        obsW = new SVG.Observable(),
        obsH = new SVG.Observable();

      var top_ = 0,
        right = W,
        bottom = W,
        left = 0;

      // Declare main rect first so corners get on top of it.
      //
      var rect= g.rect(W,W)
       .addClass("main")
       .draggable();
        
      // Create four corners (note: the corners' (0,0) will be where the main box's particular corner tracks them).
      //
      // - use 'move()' to change the 'x,y' (dragging does this)
      // - use 'translate()' to position the corner
      //
      for( var i=0; i<4; i++ ) {    // ne,se,sw,nw
        var dx = (i<2) ? right : left;
        var dy = (i==1 || i==2) ? bottom : top_;
  
        var tx = (i<2) ? -(CORNER_SIZE-CORNER_OFFSET) : -CORNER_OFFSET;
        var ty = (i==1 || i==2) ? -(CORNER_SIZE-CORNER_OFFSET) : -CORNER_OFFSET;
      
        g.rect(CORNER_SIZE,CORNER_SIZE)
          .translate( tx,ty )
          .move( dx,dy )
          .addClass("corner")
          .draggable();
      }
    })();

  </script>
  
</body>
</html>
